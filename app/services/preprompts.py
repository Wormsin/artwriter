
# Расширение базы данных
def get_stage1_prompt():
    prompt = """
            [ИНСТРУКЦИЯ]
            Внимательно проанализируй содержимое всех файлов.
            Выяви все конкретные исторические события и факты, упомянутые в этих файлах, и определи их даты (год или точную дату).
            Для каждого выявленного события из файлов подбери другие ключевые мировые события, которые произошли параллельно (в тот же год или очень близкий временной промежуток).
            Выбранные параллельные события должны быть глобально значимыми и не должны уже присутствовать во входных файлах.
            Описание параллельных событий должно включать: ключевых фигур, описание самого события, дата совершения, географическое расположение.
            [ТРЕБОВАНИЯ К ФОРМАТУ ВЫВОДА]
            Никаких вводных фраз. Не пиши "Вот список событий...", "Я проанализировал(а)..." или любые другие объяснения. Начинай ответ сразу с первого факта.
            Строгая хронология. Выводи только найденные тобой параллельные (добавленные) события. Весь список должен быть отсортирован в строгом хронологическом порядке (от самого раннего к самому позднему).
            Формат строки: Каждое событие должно быть в отдельной строке в следующем формате: [Информация о параллельном событие] - [Дата (год или точная дата)]
            """
    return prompt



# Поиск неочевидных связей
def get_stage2_prompt(lens_num):
    match lens_num:
        case 1:
            prompt = """ [ИНСТРУКЦИЯ]
                        Внимательно проанализируй содержимое всех файлов.
                        Выяви все конкретные исторические события и факты, упомянутые в этих файлах, и определи их:
                        Основные категории информации: (Фактическая, Причинно-следственная, Социально-культурная, Политическая, Экономическая, Географическая/Демографическая)
                        Временные периоды охвата: Конкретные годы или эпохи.
                        Географические области: Основные локации (страны, регионы).
                        Источники информации: Количество и их типы( при наличии источников).
                        Список событий и фактов должен быть максимально полным. Факты не должны повторяться. 
                        [ТРЕБОВАНИЯ К ФОРМАТУ ВЫВОДА]
                        Никаких вводных конструкций. Не пиши "Вот анализ...", "Я проанализировал(а)..." или любые другие объяснения.
                        Используй следующий структурированный текстовый формат для каждого факта.
                        Разделяй блоки фактов одной пустой строкой.
                        [ШАБЛОН ВЫВОДА]
                        ФАКТ: [Краткое, емкое описание]
                        * Основные категории информации: [Описание...]
                        * Временные периоды охвата: [Описание...]
                        * Ключевые фигуры и события: [Описание...]
                        * Географические области: [Описание...]
                        * Источники информации: [Описание...]
                        
                        ФАКТ: [Название второго факта]
                        * Основные категории информации: [Описание...]
                        * Временные периоды охвата: [Описание...]
                        * Ключевые фигуры и события: [Описание...]
                        * Географические области: [Описание...]
                        * Источники информации: [Описание...]
                    """
            return prompt
        case 2:
            prompt = f"""
                    [ИНСТРУКЦИЯ]
                    Проанализируй содержимое файлов: db_extension.txt, lens_{lens_num-1}_output.txt.
                    Найди статистически необычные, нетривиальные или контринтуитивные паттерны. Паттерн – это характеристика либо конкретного факта либо связи между фактами из файлов.
                    Проанализировать каждый факт по следующему алгоритму. 
                    [ЗАДАЧА АНАЛИЗА]
                    Тип паттерна: К какой категории он относится?
                    Синхронность событий: События, происходящие одновременно или с малым лагом, но в разных областях (например, технологический прорыв и культурное событие) или географических зонах.
                    Неожиданная связь персон: Персоны из разных сфер (политика, наука, искусство), связанные неявным образом (например, общее влияние, одновременные действия, косвенное взаимодействие).
                    Контр-тренд: Тренд или событие, идущее вразрез с общепринятыми представлениями или доминирующим нарративом того времени.
                    Подозрительное совпадение: Временные или географические совпадения, которые выглядят неслучайными и требуют более пристального внимания.
                    Описание: В чем суть паттерна?
                    Данные: Какие конкретные факты, даты, имена или события подтверждают этот паттерн?
                    Степень необычности: Оцени, насколько этот паттерн неочевиден (используй: Низкая, Средняя, Высокая).
                    Обоснование: Кратко поясни, почему ты считаешь этот паттерн необычным (например: "Связь отсутствует в большинстве исторических анализов", "Противоречит гипотезе Х", "Слишком точное временное совпадение").
                    [ТРЕБОВАНИЯ К ФОРМАТУ ВЫВОДА]
                    Никаких вводных конструкций. Не пиши "Вот анализ...", "Я нашел(а)...".
                    Каждый блок должен начинаться с [НАЧАЛО ПАТТЕРНА] и заканчиваться [КОНЕЦ ПАТТЕРНА].
                    Разделяй блоки одной пустой строкой.
                    [ШАБЛОН ВЫВОДА]
                    [НАЧАЛО ПАТТЕРНА] Тип: [Синхронность событий / Неожиданная связь персон / Контр-тренд / Подозрительное совпадение] Описание: [Суть паттерна] Данные: [Конкретные факты, даты, имена из предыдущего анализа] Степень необычности: [Высокая / Средняя / Низкая] Обоснование: [Почему этот паттерн необычен] [КОНЕЦ ПАТТЕРНА]
                    [НАЧАЛО ПАТТЕРНА] Тип: [Тип второго паттерна] Описание: [Описание...] Данные: [Данные...] Степень необычности: [Оценка...] Обоснование: [Обоснование...] [КОНЕЦ ПАТТЕРНА]
                    """
            return prompt
        case 3:
            prompt = f"""
                    [ИНСТРУКЦИЯ]
                    Проанализируй содержимое файла lens_{lens_num-1}_output.txt с паттернами.
                    Построй ГИПОТЕТИЧЕСКИЕ СВЯЗИ на основе паттернов из файла, используя следующие методы.
                    Связь должна соответствовать одному или нескольким методам.
                    Каждую связь оцени по шкале достоверности 1-10.
                    [МЕТОДЫ ПОСТРОЕНИЯ СВЯЗЕЙ]
                    - Применить принцип 'шести рукопожатий' между найденными элементами
                    - Поиск общих посредников, влияние которых неочевидно
                    - Определить скрытые причинно-следственные цепочки
                    - Выявить потенциальные точки влияния одних событий на другие
                    [ТРЕБОВАНИЯ К ФОРМАТУ ВЫВОДА]
                    Никаких вводных конструкций. Не пиши "Вот анализ...", "Я нашел(а)...".
                    Каждый блок должен начинаться с [НАЧАЛО СВЯЗИ] и заканчиваться [КОНЕЦ СВЯЗИ].
                    Разделяй блоки одной пустой строкой.
                    [ШАБЛОН ВЫВОДА]
                    [НАЧАЛО СВЯЗИ] Описание: [Описание связи] Ключевые данные: [люди, события, даты] Оценка достоверности: [1-10] [КОНЕЦ ПАТТЕРНА]
                    """
            return prompt
        case 4:
            prompt = f"""
                   [ИНСТРУКЦИЯ]
                    Проанализируй содержимое файла lens_{lens_num-1}_output.txt с паттернами.
                    Сформулируй 3 наиболее ПРОВОКАЦИОННЫХ гипотезы на основе найденных связей.
                    Гипотезы должны быть интригующими, но научно обоснованными.
                    Гипотезы должны соответствовать следующим критериям.
                    [КРИТЕРИИ ГИПОТЕЗ]
                    Описание гипотезы:  Каждая гипотеза должна переворачивать стандартное понимание событий
                    Данные для проверки:  Укажи, какие дополнительные данные нужны для проверки
                    Контраргументы: Опиши потенциальные контраргументы
                    Альтернативное объяснение:  Предложи альтернативные объяснения той же связи
                    [ТРЕБОВАНИЯ К ФОРМАТУ ВЫВОДА]
                    Никаких вводных конструкций. Не пиши "Вот анализ...", "Я нашел(а)...".
                    Каждый блок должен начинаться с [НАЧАЛО ГИПОТЕЗЫ] и заканчиваться [КОНЕЦ ГИПОТЕЗЫ].
                    Разделяй блоки одной пустой строкой.
                    [ШАБЛОН ВЫВОДА]
                    [НАЧАЛО ГИПОТЕЗЫ] Описание: [описание …] Данные для проверки: описание …] Контраргументы: [описание …] Альтернативное объяснение: [описание …]  [КОНЕЦ ГИПОТЕЗЫ]
                    """
            return prompt
        case 5:
            prompt = f"""
                    [ИНСТРУКЦИЯ]
                    Проанализируй содержимое файла lens_{lens_num-1}_output.txt с паттернами.
                    Оцени каждую гипотезу через следующую призму создания YouTube-контента.
                    [ПРИЗМА]
                    Шок: Насколько удивительной будет эта информация для аудитории по шкале (1-10)?
                    Усваиваемость:  Можно ли эту идею объяснить за 10-15 минут? [10-15 минут; требуется больше 15 минут]
                    Визуал: Какие визуальные материалы потребуются?
                    Эмоции: Какой эмоциональный отклик она вызовет?
                    Риск Искажения: Есть ли риск неправильной интерпретации по шкале (1-10)?
                    [ТРЕБОВАНИЯ К ФОРМАТУ ВЫВОДА]
                    Никаких вводных конструкций. Не пиши "Вот анализ...", "Я нашел(а)...".
                    Каждый блок должен начинаться с [НАЧАЛО ГИПОТЕЗЫ] и заканчиваться [КОНЕЦ ГИПОТЕЗЫ].
                    Данные о гипотезах из lens_{lens_num-1}_output.txt файла дополни проведенным анализом при ПРИЗМЕ.
                    Разделяй блоки одной пустой строкой.
                    [ШАБЛОН ВЫВОДА]
                    [НАЧАЛО ГИПОТЕЗЫ] Описание: [описание гипотезы] Данные для проверки: [описание …] Контраргументы: [описание …] Альтернативное объяснение: [описание …] Шок:[1-10]  Усваиваемость: [10-15 минут; требуется больше 15 минут] Визуал: [список приемов, видеоконтента] Эмоции: [список эмоций] Риск Искажения: [1-10] [КОНЕЦ ГИПОТЕЗЫ]
                    """
            return prompt
        case _:
            return None

# Проверка гипотез
def get_stage3_prompt(lens_num):
    match lens_num:
        case 1:
            prompt = """
                    [ИНСТРУКЦИЯ]
                    Входные данные: Ты получаешь файл db_facts.txt, содержащий список гипотез.
                    Задача:
                    Последовательно проанализируй каждую гипотезу из файла.
                    Используй инструменты поиска для проверки каждой гипотезы по четырем критериям.
                    Для поиска используй академические источники, авторитетные исторические или научные издания.
                    [КРИТЕРИИ АНАЛИЗА]
                    Подтверждение источниками: Подтверждается ли эта гипотеза независимыми авторитетными источниками?
                    Логические противоречия: Есть ли в утверждении внутренние логические ошибки?
                    Временная последовательность: Соответствует ли хронология (причина до следствия)?
                    Здравый смысл (Вероятность): Насколько эта гипотеза вероятна с точки зрения общепринятых знаний и здравого смысла?
                    [ТРЕБОВАНИЯ К ФОРМАТУ ВЫВОДА]
                    Никаких вводных конструкций.
                    Используй строгий блочный формат. Каждый блок должен начинаться с [НАЧАЛО ПРОВЕРКИ] и заканчиваться [КОНЕЦ ПРОВЕРКИ].
                    Разделяй блоки одной пустой строкой.
                    [ШАБЛОН ВЫВОДА]
                    [НАЧАЛО ПРОВЕРКИ]
                    Подтверждение источниками: [Да/Нет/Частично. Краткое пояснение и ссылки на источники, если найдены.]
                    Логические противоречия: [Обнаружены/Не обнаружены. Пояснение, если обнаружены.]
                    Временная последовательность: [Соответствует/Нарушена/Неприменимо. Пояснение.]
                    Здравый смысл (Вероятность): [Высокая/Средняя/Низкая. Обоснование.] 
                    Ссылки: [ссылки на источники используемые в процессе анализа гипотезы] [КОНЕЦ ПРОВЕРКИ]
                    """
            return prompt
        case 2:
            prompt = """
                    [ИНСТРУКЦИЯ]
                    Входные данные: Ты получаешь файл db_facts.txt, содержащий список гипотез.
                    Задача:
                    Проанализируй каждую гипотезу.
                    Для каждой гипотезы найди МИНИМУМ два альтернативных объяснения.
                    Руководствуйся следующими вопросами:
                    Могли ли быть другие причины того же эффекта?
                    Существуют ли более простые объяснения (принцип Оккама)?
                    Не является ли связь случайной корреляцией (post hoc ergo propter hoc)?
                    Какие дополнительные (скрытые) факторы могли повлиять?
                    (Опционально) Используй поиск, если это необходимо для поиска общепринятых альтернативных теорий.
                    [ТРЕБОВАНИЯ К ФОРМАТУ ВЫВОДА]
                    Никаких вводных конструкций.
                    Используй строгий блочный формат. Каждый блок должен начинаться с [НАЧАЛО ПРОВЕРКИ] и заканчиваться [КОНЕЦ ПРОВЕРКИ].
                    Разделяй блоки одной пустой строкой.
                    [ШАБЛОН ВЫВОДА]
                    [НАЧАЛО ПРОВЕРКИ]
                    Тип: [Другая причина / Простое объяснение / Случайная корреляция / Скрытый фактор]
                    Описание: [Суть альтернативного объяснения]
                    Обоснование: [Почему эта альтернатива возможна и вероятна]
                    Альтернатива 2:
                    Тип: [Другая причина / Простое объяснение / Случайная корреляция / Скрытый фактор]
                    Описание: [Суть второго альтернативного объяснения]
                    Обоснование: [Почему эта альтернатива возможна и вероятна] 
                    Ссылки: [ссылки на источники используемые в процессе анализа гипотезы][КОНЕЦ ПРОВЕРКИ]
                    """
            return prompt
        case 3:
            prompt = """
                    [ИНСТРУКЦИЯ]
                    Входные данные: Ты получаешь файл db_facts.txt, содержащий гипотезы.
                    Задача:
                    Проведи "стресс-тест" каждой гипотезы.
                    Выступи в роли скептика или критика этой идеи.
                    Используй инструменты поиска, чтобы найти контраргументы или противоречащие факты.
                    Для каждой гипотезы ответь на следующие вопросы:
                    Какие самые слабые места в аргументации этой гипотезы?
                    Что бы сказали главные критики этой идеи?.
                    Какие известные факты противоречат выводам этого паттерна?
                    Где нужны дополнительные доказательства, чтобы гипотеза стала неоспоримой?
                    [ТРЕБОВАНИЯ К ФОРМАТУ ВЫВОДА]
                    Никаких вводных конструкций.
                    Используй строгий блочный формат. Каждый блок должен начинаться с [НАЧАЛО ПРОВЕРКИ] и заканчиваться [КОНЕЦ ПРОВЕРКИ].
                    Разделяй блоки одной пустой строкой.
                    [ШАБЛОН ВЫВОДА]
                    [НАЧАЛО ПРОВЕРКИ]
                    Слабые места: [Описание главного логического или доказательного пробела]
                    Позиция критика: [Формулировка контраргумента, как если бы его высказал оппонент]
                    Противоречащие факты: [Список фактов, которые не укладываются в гипотезу или прямо ей противоречат. (Если не найдены, укажи "Не обнаружены")]
                    Необходимые доказательства: [Что конкретно нужно найти/доказать, чтобы укрепить гипотезу]
                    Ссылки: [ссылки на источники используемые в процессе анализа гипотезы] [КОНЕЦ ПРОВЕРКИ]
                    """
            return prompt
        case _:
            return None


# Построение структуры сценария
def get_stage4_prompt(num_series):
    prompt = f"""
    [ИНСТРУКЦИЯ]
    Твоя задача — создать детализированную структуру сценария, содержащую строго {num_series} серий, объединяя верифицированные факты с основным повествовательным контентом.
    [ВХОДНЫЕ ФАЙЛЫ]
    db_facts_checked.txt: Файл с проверенными гипотезами (содержит поля: Статус, Обоснование, Гипотеза).
    Прикрепленные PDF-файлы: Содержат основной, детальный контент по теме.
    [КЛЮЧЕВЫЕ ЗАДАЧИ]
    Основа сценария (Скелет): Используй файл db_facts_checked.txt как фундамент для ключевых тезисов и поворотных точек сценария.
    Фильтрация гипотез: Отбери для работы только гипотезы со статусом «Подтверждена» или «Частично». Гипотезы со статусом «Опровергнута» должны быть полностью проигнорированы.
    Обработка «Частично»: Если гипотеза имеет статус «Частично», ты обязан(а) использовать поле «Обоснование». Модифицируй или обогати исходную гипотезу, чтобы она точно отражала факты, указанные в «Обосновании». (Например, если гипотеза "Все А привели к Б", а обоснование "Только А1 и А2 привели к Б", в сценарий должен войти тезис "А1 и А2 привели к Б").
    Наполнение контентом (Мясо): Используй прикрепленные PDF-файлы как основной источник для наполнения структуры. Информация из PDF должна использоваться для:
    Детализации событий.
    Предоставления контекста.
    Связывания тезисов (гипотез) в единое, плавное повествование.
    Полная интеграция: Все отобранные (Подтвержденные и модифицированные Частичные) гипотезы должны быть логично и бесшовно интегрированы в структуру повествования.
    Логическая последовательность: Выстрой всю структуру в виде последовательного и логичного рассказа.
    [ТРЕБОВАНИЯ К ВЫВОДУ]
    Лимит: Напиши достаточное количество глав, чтобы раскрыть тему, но максимум 8. Описание каждой главы должно содержать не больше 60 слов.
    Формат: в структура содержит строго {num_series} серий.
    """
    return prompt


# Написание текста сценария (для одной серии)
def get_stage5_prompt(ser:int, ch: int, previous_chapter_text: str):
    prompt = f"""
           [ИНСТРУКЦИЯ]
            Твоя задача — написать полный, связный и готовый к использованию текст для Главы {ch} Серии {ser}.
            [ВХОДНЫЕ ФАЙЛЫ И ДАННЫЕ]
            script_structure.txt: Файл со структурой сценария.
            {previous_chapter_text}: Полный текст предыдущей главы (для обеспечения связности).
            db_facts_checked.txt: Файл с проверенными гипотезами.
            PDF-файлы: Основной источник фактического материала и деталей.
            [КЛЮЧЕВЫЕ ЗАДАЧИ]
            План: Найди в script_structure.txt описание, соответствующее Главе {ch} в Серии {ser}. Это твой обязательный план: ты должен раскрыть все тезисы, указанные для этой главы.
            Связность (Bridge): Внимательно проанализируй текст предыдущей главы. Текст новой главы должен начинаться так, чтобы создавать плавный, бесшовный и логичный переход от финала предыдущей главы.
            Наполнение (Content): Используй информацию из PDF-файлов как главный источник для раскрытия тезисов из плана (из script_structure.txt).
            Факты: Убедись, что ключевые факты и гипотезы из db_facts_checked.txt, относящиеся к этой главе (согласно структуре), органично вплетены в повествование.
            Стиль: Текст должен быть повествовательным, а не сухим перечислением фактов.
            [ТРЕБОВАНИЯ К ВЫВОДУ]
            Лимит: Текст Главы {ch} Серии {ser} должен максимально полно раскрывать тему, но при этом укладыватьтся в 350 слов.
            Формат: Выдай только сгенерированный текст главы.
            Никаких вводных конструкций. Не пиши "Глава {ch}", "Вот текст...", "Продолжение..." или любые другие мета-комментарии. Начинай сразу с первого предложения главы.
            """
    return prompt